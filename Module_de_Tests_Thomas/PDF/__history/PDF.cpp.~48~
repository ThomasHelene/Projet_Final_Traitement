//---------------------------------------------------------------------------

#pragma hdrstop

#include "PDF.h"


//---------------------------------------------------------------------------
#pragma package(smart_init)

PDF::PDF()
{

try
{
  vMSWord = Variant::GetActiveObject("Word.Application");
}
catch(...)
{
  vMSWord = Variant::CreateObject("Word.Application");
}
vMSWord.OlePropertySet("Visible", true); // ("Visible", false)
// ici on ouvre le document avec une feuille vierge
vWDocument = vMSWord.OlePropertyGet("Documents").OleFunction("Add");




}




PDF::~PDF()
{
	   WideString vFileName;
	vFileName = L"E:\\exemple.pdf";
	vWDocument.OleProcedure("SaveAs2", vFileName,17);

	vWDocuments.OleFunction("Close",false);
	vWDocument.OleFunction("Close",false);
	vMSWord.OleFunction("Quit",false);
	// on libère les Variants
	vMSWord = Unassigned;
	vWDocuments = Unassigned;
	vWDocument = Unassigned;


					ostringstream os;
	os << "-ExecutionPolicy ByPass -NoProfile -NonInteractive -WindowStyle Hidden -File \"" << CT2A(theApp.GetApplicationFolder()) << "script.ps1" << "\" \"" << CT2A(fileName) << "\" \"" << CT2A(ext) << "\"";
 	string op = "open";
 	string ps = "C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\PowerShell.exe";
 	string param = os.str();
	DWORD res = (int)ShellExecuteA(NULL, op.c_str(), ps.c_str(), param.c_str(), NULL, SW_HIDE);


}
bool PDF::Rapport()
{
	 // Centre le Pointeur
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("ParagraphFormat").OlePropertySet("Alignment", 1);
	// Change la Taille de la police
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("Font").OlePropertySet("Size",32);

	// Change la couleur du texte au rouge
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("Font").OlePropertySet("ColorIndex", 6);

	// Insère le Titre
	 vMSWord.OlePropertyGet("Selection").OleFunction("TypeText", WideString( "Rapport d'erreur "));


	 // Insère une Ligne
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("inLineShapes").OleFunction("AddHorizontalLineStandard");

	// Change la Taille de la police
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("Font").OlePropertySet("Size",18);

	// Change la couleur du texte au noir
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("Font").OlePropertySet("ColorIndex", 0);

	 // Aligne le pointeur vers la gauche
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("ParagraphFormat").OlePropertySet("Alignment", 0);

	// Insère du Texte
	 vMSWord.OlePropertyGet("Selection").OleFunction("TypeText", WideString( "Un problème a été repéré sur la pièce suivante :"));


	 //Insère l'Image
	vMSWord.OlePropertyGet("Selection").OlePropertyGet("inLineShapes").OleFunction("AddPicture",WideString("e:\\ex.png"));

}


